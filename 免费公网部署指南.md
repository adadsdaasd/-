# Digital Twin 免费公网部署指南

## 🎯 目标

让不在同一局域网的用户也能通过链接访问应用，完全免费。

---

## 📋 方案对比

| 方案 | 免费额度 | 难度 | 推荐度 | 说明 |
|------|---------|------|--------|------|
| **Streamlit Cloud** | ✅ 完全免费 | ⭐ 简单 | ⭐⭐⭐⭐⭐ | 官方服务，最推荐 |
| **ngrok** | ✅ 免费（有限制） | ⭐⭐ 中等 | ⭐⭐⭐⭐ | 内网穿透，快速测试 |
| **Render** | ✅ 免费（需信用卡） | ⭐⭐ 中等 | ⭐⭐⭐ | 稳定，但需要验证 |
| **Railway** | ✅ 免费额度 | ⭐⭐ 中等 | ⭐⭐⭐ | 简单，有使用限制 |

---

## 🚀 方案一：Streamlit Cloud（最推荐）

### 优点
- ✅ 完全免费
- ✅ 官方服务，稳定可靠
- ✅ 自动生成公网链接
- ✅ 支持 GitHub 自动部署
- ✅ 无需服务器

### 缺点
- ⚠️ 需要 GitHub 账号
- ⚠️ 代码需要公开（或使用私有仓库）

### 部署步骤

#### 1. 准备 GitHub 仓库

**方式一：创建新仓库**

1. 访问 https://github.com
2. 点击右上角 `+` → `New repository`
3. 填写仓库名：`digital-twin-app`
4. 选择 `Public`（公开）或 `Private`（私有）
5. 点击 `Create repository`

**方式二：使用现有仓库**

如果已有仓库，直接使用即可。

#### 2. 上传代码到 GitHub

**使用 Git 命令行**：

```bash
# 在项目目录下初始化 Git（如果还没有）
git init

# 添加所有文件
git add .

# 提交
git commit -m "Initial commit: Digital Twin app"

# 添加远程仓库（替换 YOUR_USERNAME 为您的 GitHub 用户名）
git remote add origin https://github.com/YOUR_USERNAME/digital-twin-app.git

# 推送代码
git branch -M main
git push -u origin main
```

**使用 GitHub Desktop（图形界面）**：

1. 下载安装 GitHub Desktop：https://desktop.github.com/
2. 打开 GitHub Desktop
3. 点击 `File` → `Add Local Repository`
4. 选择项目目录
5. 填写提交信息，点击 `Commit to main`
6. 点击 `Publish repository`

#### 3. 部署到 Streamlit Cloud

1. **访问 Streamlit Cloud**
   - 打开：https://streamlit.io/cloud
   - 点击 `Sign up` 或 `Get started`

2. **使用 GitHub 登录**
   - 点击 `Sign in with GitHub`
   - 授权 Streamlit Cloud 访问您的 GitHub

3. **创建新应用**
   - 点击 `New app`
   - 选择仓库：`digital-twin-app`
   - 选择分支：`main`
   - Main file path：`app.py`
   - 点击 `Deploy!`

4. **等待部署完成**
   - 通常需要 1-2 分钟
   - 部署完成后会显示：`Your app is live!`

5. **获取公网链接**
   - 部署完成后会显示类似链接：
     ```
     https://your-app-name.streamlit.app
     ```
   - 这个链接可以分享给任何人，随时随地访问！

#### 4. 配置环境变量（如果需要）

如果应用需要环境变量（如 API Key），在 Streamlit Cloud 中设置：

1. 在应用页面点击 `Settings`（⚙️）
2. 找到 `Secrets` 部分
3. 添加环境变量：
   ```
   DEEPSEEK_API_KEY=your-api-key-here
   ```

#### 5. 更新代码

每次代码更新后：

```bash
git add .
git commit -m "Update app"
git push
```

Streamlit Cloud 会自动重新部署！

---

## 🔧 方案二：ngrok（快速测试）

### 优点
- ✅ 完全免费
- ✅ 快速，几分钟就能用
- ✅ 不需要 GitHub
- ✅ 适合临时测试

### 缺点
- ⚠️ 免费版链接每次重启会变化
- ⚠️ 有连接数限制
- ⚠️ 不适合长期使用

### 部署步骤

#### 1. 注册 ngrok 账号

1. 访问：https://ngrok.com/
2. 点击 `Sign up` 注册（免费）
3. 验证邮箱

#### 2. 下载 ngrok

1. 访问：https://ngrok.com/download
2. 下载对应系统的版本（Windows/Mac/Linux）
3. 解压到任意目录

#### 3. 获取认证 Token

1. 登录 ngrok 后台：https://dashboard.ngrok.com/
2. 复制您的 authtoken（类似：`2abc123def456...`）

#### 4. 配置 ngrok

**Windows**：
```cmd
# 在 ngrok.exe 所在目录运行
ngrok config add-authtoken YOUR_AUTH_TOKEN
```

**Linux/Mac**：
```bash
./ngrok config add-authtoken YOUR_AUTH_TOKEN
```

#### 5. 启动应用和 ngrok

**步骤 1：启动 Streamlit 应用**

在一个命令行窗口：
```bash
streamlit run app.py
```

**步骤 2：启动 ngrok**

在另一个命令行窗口：
```bash
# Windows
ngrok http 8501

# Linux/Mac
./ngrok http 8501
```

#### 6. 获取公网链接

ngrok 会显示：

```
Forwarding  https://abc123.ngrok-free.app -> http://localhost:8501
```

**这个 `https://abc123.ngrok-free.app` 就是您的公网链接！**

可以分享给任何人访问。

#### 7. 注意事项

- ⚠️ 每次重启 ngrok，链接会变化（免费版）
- ⚠️ 需要保持两个命令行窗口都运行
- ⚠️ 免费版有连接数限制

---

## 🌐 方案三：Render（稳定免费）

### 优点
- ✅ 免费额度充足
- ✅ 稳定可靠
- ✅ 自动部署
- ✅ 支持私有仓库

### 缺点
- ⚠️ 需要信用卡验证（不扣费）
- ⚠️ 免费版有休眠机制（15分钟无访问会休眠）

### 部署步骤

#### 1. 准备代码

确保代码已上传到 GitHub（参考方案一的步骤 1-2）

#### 2. 注册 Render

1. 访问：https://render.com/
2. 点击 `Get Started for Free`
3. 使用 GitHub 登录

#### 3. 创建 Web Service

1. 点击 `New` → `Web Service`
2. 连接 GitHub 仓库
3. 选择仓库：`digital-twin-app`
4. 配置：
   - **Name**：`digital-twin-app`
   - **Region**：选择最近的区域
   - **Branch**：`main`
   - **Root Directory**：留空
   - **Environment**：`Python 3`
   - **Build Command**：`pip install -r requirements.txt`
   - **Start Command**：`streamlit run app.py --server.port $PORT --server.address 0.0.0.0`
5. 点击 `Create Web Service`

#### 4. 等待部署

- 首次部署需要 5-10 分钟
- 部署完成后会显示公网链接：
  ```
  https://digital-twin-app.onrender.com
  ```

#### 5. 配置环境变量

在 Render 控制台：
1. 点击应用 → `Environment`
2. 添加环境变量（如需要）

---

## 📱 方案四：Railway（简单快速）

### 优点
- ✅ 免费额度充足
- ✅ 部署简单
- ✅ 支持自动部署

### 缺点
- ⚠️ 需要信用卡验证
- ⚠️ 免费额度有限

### 部署步骤

1. 访问：https://railway.app/
2. 使用 GitHub 登录
3. 点击 `New Project` → `Deploy from GitHub repo`
4. 选择仓库
5. 自动检测并部署
6. 获取公网链接

---

## 🔍 为什么其他设备无法访问 localhost？

### 问题原因

`localhost` 或 `127.0.0.1` 只能在本机访问，因为：
- `localhost` = 本机回环地址
- 其他设备无法访问您的 `localhost`
- 需要公网 IP 或内网穿透

### 解决方案

1. **使用公网部署**（推荐）
   - Streamlit Cloud、Render 等
   - 自动提供公网链接

2. **使用内网穿透**
   - ngrok、frp 等工具
   - 将本地服务暴露到公网

3. **配置路由器端口转发**（复杂）
   - 需要公网 IP
   - 需要路由器管理权限
   - 不推荐，复杂且不安全

---

## 🎯 推荐方案选择

### 场景 1：正式使用，长期运行
**推荐：Streamlit Cloud**
- 完全免费
- 稳定可靠
- 自动部署

### 场景 2：快速测试，临时使用
**推荐：ngrok**
- 几分钟就能用
- 不需要 GitHub
- 适合演示

### 场景 3：需要私有仓库
**推荐：Render 或 Railway**
- 支持私有仓库
- 免费额度充足

---

## 📝 快速开始（Streamlit Cloud）

### 5分钟快速部署

```bash
# 1. 初始化 Git（如果还没有）
git init
git add .
git commit -m "Initial commit"

# 2. 创建 GitHub 仓库（在网页上）
# https://github.com/new

# 3. 推送代码
git remote add origin https://github.com/YOUR_USERNAME/digital-twin-app.git
git branch -M main
git push -u origin main

# 4. 在 Streamlit Cloud 部署
# https://streamlit.io/cloud
# 选择仓库 → Deploy

# 5. 获取公网链接
# https://your-app-name.streamlit.app
```

---

## 🔐 安全注意事项

### API Key 安全

**不要**将 API Key 直接写在代码中！

**正确做法**：

1. **使用环境变量**
   ```python
   import os
   api_key = os.getenv("DEEPSEEK_API_KEY")
   ```

2. **在部署平台设置**
   - Streamlit Cloud：Settings → Secrets
   - Render：Environment Variables
   - Railway：Variables

3. **使用 .gitignore**
   创建 `.gitignore` 文件：
   ```
   *.json
   __pycache__/
   .env
   ```

---

## 🛠️ 故障排除

### 问题 1：Streamlit Cloud 部署失败

**检查**：
- 确保 `app.py` 在根目录
- 确保 `requirements.txt` 存在且正确
- 查看部署日志中的错误信息

### 问题 2：ngrok 链接无法访问

**检查**：
- 确保 Streamlit 应用正在运行
- 确保 ngrok 指向正确的端口（8501）
- 检查防火墙设置

### 问题 3：Render 应用休眠

**解决**：
- 免费版 15 分钟无访问会休眠
- 首次访问需要等待 30-60 秒唤醒
- 或升级到付费版

---

## 📚 相关资源

- Streamlit Cloud：https://streamlit.io/cloud
- ngrok：https://ngrok.com/
- Render：https://render.com/
- Railway：https://railway.app/
- GitHub：https://github.com/

---

## 🎉 总结

**最简单的方式**：
1. 上传代码到 GitHub
2. 在 Streamlit Cloud 部署
3. 获取公网链接分享给用户

**最快的方式**：
1. 注册 ngrok
2. 启动应用和 ngrok
3. 分享 ngrok 链接

**现在您的应用可以被任何人通过链接访问了！** 🚀

---

**最后更新**：2025-02-06
